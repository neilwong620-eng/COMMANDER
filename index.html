<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commander | 2å€è³‡ç”¢ç¿»å€è¨ˆç•«</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary-blue: #2c3e50; --accent-blue: #3498db; --bg-gray: #f8f9fa; --card-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        body { font-family: 'Inter', sans-serif; background: var(--bg-gray); color: var(--primary-blue); margin: 0; padding: 20px; font-size: 0.85rem; }
        .wrapper { max-width: 1600px; margin: auto; }
        
        /* ç¬¬ä¸€æ©«æ’å°é½Šè¨­å®š */
        .main-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; align-items: stretch; margin-bottom: 20px; }
        .card { background: white; padding: 20px; border-radius: 16px; box-shadow: var(--card-shadow); border: 1px solid #eee; display: flex; flex-direction: column; }
        h2 { margin-top: 0; font-size: 1rem; border-left: 4px solid var(--accent-blue); padding-left: 10px; margin-bottom: 15px; }
        
        input, select, textarea { width: 100%; padding: 10px; border: 1.5px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; font-size: 0.95rem; }
        .total-display { background: var(--primary-blue); color: white; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 15px; }
        .total-amount { font-size: 1.6rem; font-weight: 800; display: block; }
        
        .chart-container { height: 160px; margin-bottom: 10px; }
        .exp-list { max-height: 100px; overflow-y: auto; border-top: 1px solid #eee; padding-top: 5px; }
        .exp-item { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px dashed #f0f0f0; }

        /* ç¬¬äºŒæ’ï¼šç›®æ¨™ç¿»å€å€ */
        .target-section { grid-column: span 3; background: #eef2f7; border: 2px solid var(--primary-blue); border-radius: 16px; padding: 25px; margin-top: 10px; }
        .target-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; }
        .progress-circle { display: flex; flex-direction: column; align-items: center; justify-content: center; background: white; border-radius: 12px; padding: 20px; border: 1px solid #d1d9e6; }
        .advice-box { background: white; padding: 20px; border-radius: 12px; border: 1px solid #d1d9e6; }
        
        .suggestion-box { background: #f0f7ff; border-radius: 10px; padding: 12px; border: 1px dashed var(--accent-blue); font-size: 0.8rem; }
        .news-item { border-bottom: 1px solid #f0f0f0; padding: 8px 0; }
        .news-item a { color: var(--accent-blue); text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>

<div class="wrapper">
    <header style="text-align:center; margin-bottom:20px;">
        <h1 style="margin:0; font-size: 1.5rem;">COMMANDER 11.5</h1>
        <p style="opacity:0.7;">å¯¦æˆ°æŒ‡æ® â•³ è‡ªå‹•æ‰£æ¬¾ â•³ è³‡ç”¢ç¿»å€ç›®æ¨™</p>
    </header>

    <div class="main-grid">
        <div class="card">
            <h2>ğŸ’° å¸³æˆ¶é¤˜é¡ (è‡ªå‹•æ‰£æ¬¾)</h2>
            <div style="display: flex; gap: 5px;">
                <input type="number" id="bank1" placeholder="B1" oninput="calculateAll()">
                <input type="number" id="bank2" placeholder="B2" oninput="calculateAll()">
                <input type="number" id="bank3" placeholder="B3" oninput="calculateAll()">
            </div>
            <div style="display: flex; gap: 5px;">
                <input type="number" id="forex-bal" placeholder="å¤–å¹£" oninput="calculateAll()">
                <select id="currency-type" onchange="calculateAll()" style="width: 80px;">
                    <option value="EUR">EUR</option><option value="JPY">JPY</option><option value="USD">USD</option>
                </select>
            </div>
            <div class="total-display">
                <span id="total-val" class="total-amount">NT$ 0</span>
                <div id="rent-info" style="font-size: 0.7rem; opacity: 0.8;">æˆ¿ç§Ÿ $6,500 | æ·¨è³‡ç”¢è¨ˆç®—ä¸­</div>
            </div>
            <div class="chart-container"><canvas id="allocationChart"></canvas></div>
            <h3 style="font-size:0.8rem; margin: 10px 0 5px 0;">ğŸ“ ä»Šæ—¥æ¶ˆè²»æ‰£æ¬¾</h3>
            <div style="display:flex; gap:5px;">
                <input type="text" id="exp-name" placeholder="é …ç›®" style="flex:2;">
                <input type="number" id="exp-amt" placeholder="é‡‘é¡" style="flex:1;">
                <button onclick="addExpense()" style="width:40px; height:38px; border-radius:8px; border:none; background:var(--accent-blue); color:white;">+</button>
            </div>
            <div id="exp-list" class="exp-list"></div>
        </div>

        <div class="card">
            <h2>ğŸš€ éŠ·å”®æˆ°ç•¥æ™ºåº«</h2>
            <textarea id="product-desc" rows="3" placeholder="å…§å®¹ç‰©æè¿°" oninput="analyzeSales()"></textarea>
            <div style="display: flex; gap: 5px;">
                <input type="number" id="cost-input" placeholder="æˆæœ¬" oninput="analyzeSales()">
                <input type="number" id="target-price" placeholder="å”®åƒ¹" oninput="analyzeSales()">
            </div>
            <div id="sales-result" class="suggestion-box" style="display:none; height: 100%;"></div>
            <div style="margin-top:auto; font-size:0.8rem; color:#666; padding-top:10px;">
                ğŸ’¡ æ·¨åˆ©æ»¾å…¥æŠ•è³‡ï¼Œæ˜¯è³‡ç”¢ç¿»å€çš„æœ€å¿«è·¯å¾‘ã€‚
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“ˆ æ¨™çš„æœå°‹èˆ‡å¿«è¨Š</h2>
            <input type="text" id="stock-search" placeholder="æœå°‹ä»£ç¢¼ (0056, 00981...)" oninput="searchStock()">
            <div id="stock-advice" class="suggestion-box" style="display:none; margin-bottom: 10px;"></div>
            <div id="news-container" style="max-height: 400px; overflow-y: auto;">
                <div class="news-item">åŒæ­¥æœ€æ–°è²¡ç¶“å¿«è¨Š...</div>
            </div>
        </div>

        <div class="target-section">
            <h2 style="border-left-color: var(--primary-blue);">ğŸ¯ 2å€è³‡ç”¢ç¿»å€é€²åº¦ (ç›®æ¨™: NT$ <span id="target-goal-text">0</span>)</h2>
            <div class="target-grid">
                <div class="progress-circle">
                    <span style="font-size: 1rem; color: #666;">ç›®å‰é”æˆç‡</span>
                    <span id="target-percent" style="font-size: 2.5rem; font-weight: 800; color: var(--accent-blue);">0%</span>
                    <span id="target-diff" style="font-size: 0.85rem; color: #e74c3c; margin-top: 10px;">é‚„å·® $0</span>
                </div>
                <div class="advice-box">
                    <b style="font-size: 1.1rem; color: var(--primary-blue);">ğŸš€ ç¿»å€æˆ°ç•¥å»ºè­°ï¼š</b>
                    <div id="target-advice-text" style="margin-top: 10px; line-height: 1.6; font-size: 0.95rem;">
                        è«‹åœ¨ä¸Šæ–¹è¼¸å…¥è³‡ç”¢ï¼Œç³»çµ±å°‡ç‚ºä½ è¦åŠƒ 2 å€ç¿»å€è·¯å¾‘ã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentRates = { EUR: 34.5, JPY: 0.21, USD: 31.5 };
    let expenses = [];
    let myChart;
    let netGlobal = 0;

    function calculateAll() {
        const b1 = parseFloat(document.getElementById('bank1').value) || 0;
        const b2 = parseFloat(document.getElementById('bank2').value) || 0;
        const b3 = parseFloat(document.getElementById('bank3').value) || 0;
        const forex = parseFloat(document.getElementById('forex-bal').value) || 0;
        const currType = document.getElementById('currency-type').value;
        const gross = b1 + b2 + b3 + (forex * currentRates[currType]);
        const totalExp = expenses.reduce((s, i) => s + i.amt, 0);
        netGlobal = gross - totalExp;
        
        document.getElementById('total-val').innerText = 'NT$ ' + netGlobal.toLocaleString();
        const rentP = netGlobal > 0 ? ((6500 / netGlobal) * 100).toFixed(1) : 0;
        document.getElementById('rent-info').innerText = `æˆ¿ç§Ÿ $6,500 | ä½”æ·¨è³‡ç”¢ ${rentP}%`;

        // æ›´æ–°ç¿»å€ç›®æ¨™é‚è¼¯ (ä»¥ 20 è¬ç‚ºåŸºæº–æˆ–ç›®å‰è³‡ç”¢çš„ 2 å€)
        const targetGoal = 200000; // ä½ è¨­å®šçš„åŸºæº–ç›®æ¨™
        const flipGoal = targetGoal * 2;
        document.getElementById('target-goal-text').innerText = flipGoal.toLocaleString();
        
        const progress = Math.min(100, (netGlobal / flipGoal) * 100).toFixed(1);
        document.getElementById('target-percent').innerText = progress + '%';
        document.getElementById('target-diff').innerText = `é‚„å·® $${Math.max(0, flipGoal - netGlobal).toLocaleString()}`;
        
        // æˆ°ç•¥å»ºè­°
        const advice = document.getElementById('target-advice-text');
        if (netGlobal < targetGoal) {
            advice.innerHTML = "<b>éšæ®µ 1ï¼šåŸå§‹ç©ç´¯ã€‚</b><br>é‡é»åœ¨æ–¼ã€ä¸»å‹•æ”¶å…¥ã€ã€‚åˆ©ç”¨ä½ çš„è²¼ç´™ç”Ÿæ„è³ºå–æ¯ç­† 150 å…ƒçš„åˆ©æ½¤ã€‚é€™ç­†éŒ¢ä¸è¦äº‚èŠ±ï¼Œæ‰£æ‰æˆ¿ç§Ÿå¾Œå…¨éƒ¨æŠ•å…¥ 0056ã€‚";
        } else if (netGlobal < flipGoal) {
            advice.innerHTML = "<b>éšæ®µ 2ï¼šè¤‡åˆ©åŠ é€Ÿã€‚</b><br>ç›®å‰è³‡ç”¢å·²é”æ¨™ã€‚å»ºè­°å°‡ 50% æ”¾å…¥ 00981 (æ—¥æœ¬é ˜èˆª) æˆ– 0050ï¼Œåˆ©ç”¨å¸‚å ´æ³¢å‹•èˆ‡é…ç½®ç¸®çŸ­ç¿»å€æ™‚é–“ã€‚ç¹¼çºŒä¿æŒæ¯æ—¥é–‹éŠ·ç›£æ§ã€‚";
        } else {
            advice.innerHTML = "<b>éšæ®µ 3ï¼šè³‡ç”¢é‡çµ„ã€‚</b><br>æ­å–œç¿»å€ï¼ç¾åœ¨æ‡‰é‡æ–°è¨­å®šç›®æ¨™ã€‚å»ºè­°å°‡éƒ¨åˆ†è³‡é‡‘è½‰å…¥å¤–å¹£é¿éšªï¼Œæˆ–å°‹æ‰¾ä¸‹ä¸€æ³¢æ¨‚é«˜ç¨€ç¼ºè²¨æºã€‚";
        }

        if (myChart) {
            const invest = Math.max(0, netGlobal - 6500);
            myChart.data.datasets[0].data = [6500, invest * 0.5, invest * 0.3, invest * 0.2];
            myChart.update();
        }
        localStorage.setItem('cmd_flip_data', JSON.stringify({b1, b2, b3, forex, currType, expenses}));
    }

    function addExpense() {
        const name = document.getElementById('exp-name').value;
        const amt = parseFloat(document.getElementById('exp-amt').value);
        if (name && amt) {
            expenses.unshift({name, amt, time: new Date().toLocaleTimeString()});
            document.getElementById('exp-name').value = ''; document.getElementById('exp-amt').value = '';
            renderExpenses(); calculateAll();
        }
    }
    function renderExpenses() {
        document.getElementById('exp-list').innerHTML = expenses.map((i, idx) => `
            <div class="exp-item"><span>${i.name}</span><b>$${i.amt} <span onclick="removeExp(${idx})" style="color:red;cursor:pointer">Ã—</span></b></div>
        `).join('');
    }
    function removeExp(i) { expenses.splice(i, 1); renderExpenses(); calculateAll(); }

    function searchStock() {
        const s = document.getElementById('stock-search').value.toUpperCase();
        const box = document.getElementById('stock-advice');
        box.style.display = s ? 'block' : 'none';
        const db = { '0056': '0056ï¼šç©©å®šé…æ¯ï¼Œè³‡ç”¢ç¿»å€çš„é˜²å®ˆå¢Šã€‚', '00981': '00981ï¼šæ—¥è‚¡å‹•èƒ½å¼·ï¼Œæ˜¯åŠ é€Ÿç¿»å€çš„é€²æ”»æ¨™çš„ã€‚', '0050': '0050ï¼šå°è‚¡åŸºçŸ³ã€‚' };
        box.innerHTML = db[s] || `åˆ†æä¸­...`;
    }

    function analyzeSales() {
        const desc = document.getElementById('product-desc').value;
        const cost = parseFloat(document.getElementById('cost-input').value) || 0;
        const price = parseFloat(document.getElementById('target-price').value) || 0;
        const box = document.getElementById('sales-result');
        if (!desc && !cost && !price) { box.style.display = 'none'; return; }
        box.style.display = 'block';
        box.innerHTML = `ç²åˆ©ï¼š$${price-cost} | é€™æ˜¯ä½ é‚å‘ç¿»å€è¨ˆç•«çš„å¾®å°æ¨é€²ã€‚`;
    }

    async function fetchNews() {
        try {
            const res = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://tw.news.yahoo.com/rss/finance');
            const data = await res.json();
            document.getElementById('news-container').innerHTML = data.items.slice(0, 8).map(i => `<div class="news-item"><a href="${i.link}" target="_blank">${i.title}</a></div>`).join('');
        } catch (e) {}
    }

    window.onload = function() {
        const ctx = document.getElementById('allocationChart').getContext('2d');
        myChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['æˆ¿ç§Ÿ', 'æŠ•è³‡', 'çµè²¨', 'å‰©é¤˜'], datasets: [{ data: [6500, 0, 0, 0], backgroundColor: ['#e74c3c', '#3498db', '#f1c40f', '#2ecc71'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 9 } } } } } });
        const saved = JSON.parse(localStorage.getItem('cmd_flip_data') || '{}');
        document.getElementById('bank1').value = saved.b1 || '';
        document.getElementById('bank2').value = saved.b2 || '';
        document.getElementById('bank3').value = saved.b3 || '';
        document.getElementById('forex-bal').value = saved.forex || '';
        document.getElementById('currency-type').value = saved.currType || 'EUR';
        expenses = saved.expenses || [];
        renderExpenses(); calculateAll(); fetchNews();
    };
</script>
</body>
</html>
